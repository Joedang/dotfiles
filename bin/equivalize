#!/usr/bin/env bash
# Replace standard ASCII characters with Unicode look-alikes.
# vim: foldmethod=marker:
# Joe Shields, 2021-01-10

## I generated the namePatterns and except_exclude arrays manually, but these snippets made it easier. {{{
## Generate an array that you can type the human-readable names into. (You'll need to manually escape stuff like " ' `)
#for dec in 9 {32..126};do # list the printable ascii characters (including tab)
#    oct=$(printf '\\%o' "$dec") # convert decimal representation to octal escape
#    printf "[\"$oct\"]=\"$oct\"\n"
#done
#for dec in 9 {32..126};do # print the Unicode names of the ASCII characters
#    #hex=$(printf '\\U%0*x' 8 "$dec")
#    hex=$(printf '%0*x' 4 "$dec")
#    grep -i "^[^;]*$hex;" ~/.local/share/UnicodeData.txt | head -n 1
#done
# }}}

# parameters {{{
equivFile="$HOME/.local/share/UnicodeEquivalents.txt"
dataUrl=https://www.unicode.org/Public/UCD/latest/ucd/UnicodeData.txt
dataLocation="$HOME/.local/share/UnicodeData.txt"
helpText="Usage: ${0##*/} [OPTIONS] [TEXT ...]

Replace standard ASCII characters with random Unicode look-alikes.

Options:
    -g  Generate (or regenerate) the list of look-alike characters.
    -h  Display this help text.

If no TEXT is in the arguments, characters will be read from stdin.
So, this command may be used in a pipeline.

If the UnicodeData.txt file or the list of look-alike characters are not present,
they will be downloaded or generated, respectively.

The effect yields very stylized 'cursed' text. If you want something more subtle, 
an easy solution would be to remove the extravagant characters from the
look-alike file. (The first character of every line is the ASCII character, the
remaining characters are the look-alikes.) Of course, you can also tweak the 
patterns and exceptions used to generate that file.  "
# }}}

declare -A namePatterns=( # {{{
# The patterns are used to search in the Unicode data file when generating visual equivalents.
# They identify candidates for look-alike characters.
['0020']='SPACE'                    # " "
['0021']='EXCLAMATION'              # "!"
['0022']='DOUBLE.*QUOTATION'        # """
['0023']='NUMBER SIGN'              # "#"
['0024']='DOLLAR SIGN'              # "$"
['0025']='PERCENT SIGN'             # "%"
['0026']='AMPERSAND'                # "&"
['0027']='APOSTROPHE'               # "'"
['0028']='LEFT PARENTHESIS'         # "("
['0029']='RIGHT PARENTHESIS'        # ")"
['002A']='ASTERISK'                 # "*"
['002B']='PLUS SIGN'                # "+"
['002C']='COMMA'                    # ","
['002D']='HYPHEN-MINUS'             # "-"
['002E']='FULL STOP'                # "."
['002F']='SOLIDUS'                  # "/"
['0030']='DIGIT ZERO'               # "0"
['0031']='DIGIT ONE'                # "1"
['0032']='DIGIT TWO'                # "2"
['0033']='DIGIT THREE'              # "3"
['0034']='DIGIT FOUR'               # "4"
['0035']='DIGIT FIVE'               # "5"
['0036']='DIGIT SIX'                # "6"
['0037']='DIGIT SEVEN'              # "7"
['0038']='DIGIT EIGHT'              # "8"
['0039']='DIGIT NINE'               # "9"
['003A']='[ ;]COLON'                # ":"
['003B']='SEMICOLON'                # ";"
['003C']='LESS-THAN SIGN'           # "<"
['003D']='EQUALS SIGN'              # "="
['003E']='GREATER-THAN SIGN'        # ">"
['003F']='QUESTION MARK'            # "?"
['0040']='COMMERCIAL AT'            # "@"
['0041']='CAPITAL LETTER A[ ;]'     # "A"
['0042']='CAPITAL LETTER B[ ;]'     # "B"
['0043']='CAPITAL LETTER C[ ;]'     # "C"
['0044']='CAPITAL LETTER D[ ;]'     # "D"
['0045']='CAPITAL LETTER E[ ;]'     # "E"
['0046']='CAPITAL LETTER F[ ;]'     # "F"
['0047']='CAPITAL LETTER G[ ;]'     # "G"
['0048']='CAPITAL LETTER H[ ;]'     # "H"
['0049']='CAPITAL LETTER I[ ;]'     # "I"
['004A']='CAPITAL LETTER J[ ;]'     # "J"
['004B']='CAPITAL LETTER K[ ;]'     # "K"
['004C']='CAPITAL LETTER L[ ;]'     # "L"
['004D']='CAPITAL LETTER M[ ;]'     # "M"
['004E']='CAPITAL LETTER N[ ;]'     # "N"
['004F']='CAPITAL LETTER O[ ;]'     # "O"
['0050']='CAPITAL LETTER P[ ;]'     # "P"
['0051']='CAPITAL LETTER Q[ ;]'     # "Q"
['0052']='CAPITAL LETTER R[ ;]'     # "R"
['0053']='CAPITAL LETTER S[ ;]'     # "S"
['0054']='CAPITAL LETTER T[ ;]'     # "T"
['0055']='CAPITAL LETTER U[ ;]'     # "U"
['0056']='CAPITAL LETTER V[ ;]'     # "V"
['0057']='CAPITAL LETTER W[ ;]'     # "W"
['0058']='CAPITAL LETTER X[ ;]'     # "X"
['0059']='CAPITAL LETTER Y[ ;]'     # "Y"
['005A']='CAPITAL LETTER Z[ ;]'     # "Z"
['005B']='LEFT SQUARE BRACKET'      # "["
['005C']='REVERSE SOLIDUS'          # "\"
['005D']='RIGHT SQUARE BRACKET'     # "]"
['005E']='CIRCUMFLEX ACCENT'        # "^"
['005F']='LOW LINE'                 # "_"
['0060']='GRAVE ACCENT'             # "`"
['0061']='SMALL LETTER A[ ;]'       # "a"
['0062']='SMALL LETTER B[ ;]'       # "b"
['0063']='SMALL LETTER C[ ;]'       # "c"
['0064']='SMALL LETTER D[ ;]'       # "d"
['0065']='SMALL LETTER E[ ;]'       # "e"
['0066']='SMALL LETTER F[ ;]'       # "f"
['0067']='SMALL LETTER G[ ;]'       # "g"
['0068']='SMALL LETTER H[ ;]'       # "h"
['0069']='SMALL LETTER I[ ;]'       # "i"
['006A']='SMALL LETTER J[ ;]'       # "j"
['006B']='SMALL LETTER K[ ;]'       # "k"
['006C']='SMALL LETTER L[ ;]'       # "l"
['006D']='SMALL LETTER M[ ;]'       # "m"
['006E']='SMALL LETTER N[ ;]'       # "n"
['006F']='SMALL LETTER O[ ;]'       # "o"
['0070']='SMALL LETTER P[ ;]'       # "p"
['0071']='SMALL LETTER Q[ ;]'       # "q"
['0072']='SMALL LETTER R[ ;]'       # "r"
['0073']='SMALL LETTER S[ ;]'       # "s"
['0074']='SMALL LETTER T[ ;]'       # "t"
['0075']='SMALL LETTER U[ ;]'       # "u"
['0076']='SMALL LETTER V[ ;]'       # "v"
['0077']='SMALL LETTER W[ ;]'       # "w"
['0078']='SMALL LETTER X[ ;]'       # "x"
['0079']='SMALL LETTER Y[ ;]'       # "y"
['007A']='SMALL LETTER Z[ ;]'       # "z"
['007B']='LEFT CURLY BRACKET'       # "{"
['007C']='VERTICAL LINE'            # "|"
['007D']='RIGHT CURLY BRACKET'      # "}"
['007E']='TILDE'                    # "~"
) # }}}
declare -A except_exclude=(  # {{{
# These are exceptions that pass the name patterns but don't look like the ASCII characters.
# They are excluded from the list of look-alikes when generating visual equivalents.
['0020']='á¡áš€âˆâ ã€¿ğ™°ğ™±ğ™²ğ™³ğ™´ğ™µğ™¶ğ™·ğ™¸ğ™¹ğ™ºğ™»ğ™¼ğ™½ğ™¾ğ™¿ğš€ğšğš‚ğšƒğš„ğš…ğš†ğš‡ğšˆğš‰ğšŠğš‹ğšŒğšğšğšğšğš‘ğš’ğš“ğš”ğš•ğš–ğš—ğš˜ğš™ğššğš›ğšœğšğšğšŸğš ğš¡ğš¢ğš£ğŸ¶ğŸ·ğŸ¸ğŸ¹ğŸºğŸ»ğŸ¼ğŸ½ğŸ¾ğŸ¿ğ©¿ğª€'$'\U0008\UE0020' # " "
['0021']='Õœß¹á‚Ÿê©·ğŸ†™ğŸ”›'   # "!"
['0022']='ğ‘¿©â€â â¹‚ã€ ã€ŸğŸ™¸' # """
['0023']='à¯ºğ‘¿©'         # "#"
['0024']='ğŸ„'          # "$"
['0025']=''           # "%"
['0026']='Û½'          # ampersand
['0027']='Å‰'          # "'"
['0028']='â›âœâï¸µ'      # "("
['0029']='ââŸâ ï¸¶'      # ")"
['002A']='âœ¢âœ£âœ¤âœ¥â©®ê™³ğ’‹¬ğ’”'   # "*"
['002B']='âª¿â«€ï¬©â¨¹'       # "+"
['002C']='È˜È™ÈšÈ›Ê»Ê½Õß¸à¼”á£á ‚á ˆâ€˜â€™â€›â€œâ€â€Ÿâªâ›âœâââ¨©â¹‰â¹Œ ê“¾ê˜ê›µêœ®êœ¯ï¸ï¸‘ğª‡ğŸ„ğŸ„‚ğŸ„ƒğŸ„„ğŸ„…ğŸ„†ğŸ„‡ğŸ„ˆğŸ„‰ğŸ„ŠğŸ™¶ğŸ™·' # ","
['002D']=''           # "-"
['002E']='Ö‰Û”á¢á™®á ƒá ‰â’ˆâ’‰â’Šâ’‹â’Œâ’â’â’â’â’‘â’’â’“â’”â’•â’–â’—â’˜â’™â’šâ’›â³¹â³¾â¸¼ ê“¿ê˜ê›³ï¸’ğ–«µğ›²ŸğªˆğŸ„€' # "."
['002F']='\âŸˆâŸ‰â¦¸â§µâ§·â§¹ï¹¨ï¼¼ğŸ™½' # "/" I'd rather have exceptions for "reverse solidus" characters than enable extended/Perl regex for the big search
['0030']='Ù Û°àµ¦à·¦ğ‘¥ğ–­'                                                             # "0"
['0031']='Ù¡Û±à¥§à§§à©§à«§à­§à¯§à±§à±¼à³§àµ§à·§à¹‘à»‘à¼¡áá©áŸ¡á ‘á¥‡á§‘á§šáªáª‘á­‘á®±á±á±‘ê˜¡ê£‘ê¤ê§‘ê§±ê©‘ê¯±ğ‹¡ğ’¡ğ©€ğ¹ ğ‘§ğ‘ƒ±ğ‘„·ğ‘‡‘ğ‘‡¡ğ‘‹±ğ‘‘‘ğ‘“‘ğ‘™‘ğ‘›ğ‘œ±ğ‘¥‘ğ‘±‘ğ‘µ‘ğ‘¶¡ğ–©¡ğ–­‘ğ ğ©ğŸ¯±'       # "1"
['0032']='Ù¢Û²İ³İµİ¸İºß‚à¥¨à§¨à©¨à­¨à¯¨à±¨à±ºà³¨àµ¨à·¨à¹’à»’á‚á‚’áªáŸ¢á ’á¥ˆá§’áª‚áª’á­’á®²á±‚á±’â†Šê˜¢ê£’ê¤‚ê§’ê§²ê©’ê¯²ğ‹¢ğ’¢ğ©ğ´²ğ¹¡ğ‘¨ğ‘ƒ²ğ‘‡’ğ‘‡¢ğ‘›‚ğ‘œ²ğ‘¥’ğ‘±’ğ‘µ’ğ‘¶¢ğ–©¢ğ–­’ğ¡ğªğ…‚ğ‹²ğ£ˆ'     # "2"
['0033']='Ù£Û³İ´İ¶İ¹İ»ßƒà§©à­©à¯©à±»à±¾à³©àµ©à·©à¹“à»“à¼£áƒá‚“á«áŸ£á “á¥‰á§“áªƒáª“á­“á®³á±“â†‹ê˜£ê¤ƒê§“ê©“ê¯³ğ‹£ğ’£ğ©‚ğ´³ğ¹¢ğ‘ƒ³ğ‘„¹ğ‘‡£ğ‘œ³ğ‘¥“ğ‘µ“ğ‘¶£ğ–©£ğ–­“ğ¢ğ«ğ…ƒğ‹³ğ£‰'            # "3"
['0034']='Ù¤Û´İ·İ¼İ½ß„à¥ªà§ªà©ªà«ªà­ªà¯ªà±ªà³ªàµªà·ªà¹”à»”à¼¤á„á‚”á¬áŸ¤á ”á¥Šá§”áª„áª”á­”á®´á±„á±”ê˜¤ê£”ê¤„ê§”ê§´ê©”ê¯´ğ‹¤ğ’¤ğ©ƒğ´´ğ¹£ğ‘ªğ‘ƒ´ğ‘„ºğ‘‡”ğ‘‡¤ğ‘‹´ğ‘‘”ğ‘“”ğ‘™”ğ‘›„ğ‘œ´ğ‘¥”ğ‘±”ğ‘µ”ğ‘¶¤ğ–©¤ğ–­”ğ£ğ¬ğ…„ğ‹´ğ£Š' # "4"
['0035']='Ù¥Ûµß…à¥«à§«à©«à««à­«à¯«à±«à³«àµ«à·«à¹•à»•à¼¥á…á‚•á­áŸ¥á •á¥‹á§•áª…áª•á­•á®µá±…á±•ê˜¥ê£•ê¤…ê§•ê§µê©•ê¯µğ‹¥ğ’¥ğ´µğ¹¤ğ‘«ğ‘ƒµğ‘„»ğ‘‡•ğ‘‡¥ğ‘‹µğ‘‘•ğ‘“•ğ‘™•ğ‘›…ğ‘œµğ‘¥•ğ‘±•ğ‘µ•ğ‘¶¥ğ–©¥ğ–­•ğ¤ğ­ğ……ğ‹µğ£‹'     # "5"
['0036']='Ù¦Û¶ß†à¥¬à§¬à©¬à«¬à­¬à¯¬à±¬à³¬àµ¬à·¬à¹–à»–à¼¦á†á‚–á®áŸ¦á –á¥Œá§–áª†áª–á­–á®¶á±†á±–ê˜¦ê£–ê¤†ê§–ê§¶ê©–ê¯¶ğ‹¦ğ’¦ğ´¶ğ¹¥ğ‘¬ğ‘ƒ¶ğ‘„¼ğ‘‡–ğ‘‡¦ğ‘‹¶ğ‘‘–ğ‘“–ğ‘™–ğ‘›†ğ‘œ¶ğ‘¥–ğ‘±–ğ‘µ–ğ‘¶¦ğ–©¦ğ–­–ğ¥ğ®ğ…†ğ‹¶ğ£Œ'     # "6"
['0037']='Ù§Û·ß‡à¥­à§­à©­à«­à­­à¯­à±­à³­àµ­à·­à¹—à»—à¼§á‡á‚—á¯áŸ§á —á¥á§—áª‡áª—á­—á®·á±‡á±—ê˜§ê£—ê¤‡ê§—ê§·ê©—ê¯·ğ‹§ğ’§ğ´·ğ¹¦ğ‘­ğ‘ƒ·ğ‘„½ğ‘‡—ğ‘‡§ğ‘‹·ğ‘‘—ğ‘“—ğ‘™—ğ‘›‡ğ‘œ·ğ‘¥—ğ‘±—ğ‘µ—ğ‘¶§ğ–©§ğ–­—ğ¦ğ¯ğ…‡ğ‹·ğ£'     # "7"
['0038']='Ù¨Û¸ßˆà¥®à§®à©®à«®à­®à¯®à±®à³®àµ®à·®à¹˜à»˜à¼¨áˆá‚˜á°áŸ¨á ˜á¥á§˜áªˆáª˜á­˜á®¸á±ˆá±˜ê˜¨ê£˜ê¤ˆê§˜ê§¸ê©˜ê¯¸ğ‹¨ğ’¨ğ´¸ğ¹§ğ‘®ğ‘ƒ¸ğ‘„¾ğ‘‡˜ğ‘‡¨ğ‘‹¸ğ‘‘˜ğ‘“˜ğ‘™˜ğ‘›ˆğ‘œ¸ğ‘¥˜ğ‘±˜ğ‘µ˜ğ‘¶¨ğ–©¨ğ–­˜ğ§ğ°ğ…ˆğ‹¸ğ£'     # "8"
['0039']='ß‰à¥¯à§¯à©¯à«¯à­¯à¯¯à±¯à³¯àµ¯à·¯à¹™à»™à¼©á‰á‚™á±áŸ©á ™á¥á§™áª‰áª™á­™á®¹á±‰á±™ê˜©ê£™ê¤‰ê§™ê§¹ê©™ê¯¹ ğ‹©ğ’©ğ´¹ğ¹¨ğ‘ƒ¹ğ‘„¿ğ‘‡™ğ‘‡©ğ‘‹¹ğ‘‘™ğ‘“™ğ‘™™ğ‘›‰ğ‘œ¹ğ‘¥™ğ‘±™ğ‘µ™ğ‘¶©ğ–©©ğ–­™ğ¨ğ±ğ…‰ğ‹¹ğ£'       # "9"
['003A']='Ü…Ü†Ü‡â‚¡â‰”â‰•ê›´ğ’‘²ğªŠ'  # ":"
['003B']='á¤ê›¶ğª‰'        # ";"
['003C']=''           # "<"
['003D']=''           # "="
['003E']=''           # ">"
['003F']='Í¾Õá§â©»â©¼â³ºâ³»ê˜ê›·ğ‘…ƒ' # "?"
['0040']=''           # "@"
['0041']='Ã†Ç¢'         # "A"
['0042']=''           # "B"
['0043']=''           # "C"
['0044']='Ç„Ç…Ç²Æ‹'       # "D"
['0045']=''           # "E"
['0046']=''           # "F"
['0047']=''           # "G"
['0048']='Òºğ'         # "H"
['0049']='Ä²ĞĞ˜Ó¢Ó¤'      # "I"
['004A']=''           # "J"
['004B']=''           # "K"
['004C']='Ç‡Çˆ'         # "L"
['004D']=''           # "M"
['004E']='ÇŠÇ‹È '        # "N"
['004F']='Å’Ò¨'         # "O"
['0050']='ê”'          # "P"
['0051']=''           # "Q"
['0052']=''           # "R"
['0053']=''           # "S"
['0054']=''           # "T"
['0055']='Ğ£Ó®Ó°Ó²'       # "U"
['0056']='Æ²'          # "V"
['0057']=''           # "W"
['0058']=''           # "X"
['0059']=''           # "Y"
['005A']=''           # "Z"
['005B']='â¢ï¹‡'        # "["
['005C']='âŸˆ'          # "\"
['005D']='â¥ï¹ˆ'        # "]"
['005E']='â¨£â¨¶â©¯'        # "^"
['005F']='ï¸³ï¸´ğ›²–'      # "_"
['0060']='ËËµÑ¶Ñ·'$'\U300\U316\U1dc0\U0953' # "`"
['0061']='Ã¦Ç£ê¬±ê­°'       # "a"
['0062']=''           # "b"
['0063']='É•Í¨á·—'          # "c"
['0064']='Ç†Ê£Ê¤Ê¥Í©'       # "d"
['0065']='ê­±'          # "e"
['0066']=''           # "f"
['0067']=''           # "g"
['0068']='ğ¸Æ•'         # "h"
['0069']='Ä³Ğ¸ÑÓ£Ó¥ê­²'     # "i"
['006A']='ÇˆÇ‹'         # "j"
['006B']=''           # "k"
['006C']='Ç‰É®'         # "l"
['006D']=''           # "m"
['006E']='ÇŒ'          # "n"
['006F']='Å“Ò©ê­³'        # "o"
['0070']='ê•'          # "p"
['0071']=''           # "q"
['0072']=''           # "r"
['0073']=''           # "s"
['0074']='Ê¦Ê§Ê¨'        # "t"
['0075']='ÑƒÓ¯Ó±Ó³'       # "u"
['0076']='Ê‹'          # "v"
['0077']=''           # "w"
['0078']=''           # "x"
['0079']=''           # "y"
['007A']='Ç…Ç²'         # "z"
['007B']='ï¸·â§â©â±'      # "{"
['007C']='ËˆËŒ'         # "|"
['007D']='â«â­â°ï¸¸'      # "}"
['007E']='ÃƒÃ‘Ã•Ã£Ã±ÃµÄ¨Ä©Å¨Å©ÆŸÈ¬È­É«áµ¬áµ­áµ®áµ¯áµ°áµ±áµ²áµ³áµ´áµµáµ¶á¸šá¸›á¸¬á¸­á¹Œá¹á¹á¹á¹´á¹µá¹¸á¹¹á¹¼á¹½áºªáº«áº´áºµáº¼áº½á»„á»…á»–á»—á» á»¡á»®á»¯á»¸á»¹â«â­â±â²â¥²â¥³â¥´â§¤â¨¤â¨¦â«‡â«ˆâ«³â­â­‡â­‰â­‹â­Œâ±¢â¸¯ê¬¸ê­ê­¨' # "~"
) # }}}
declare -A except_include=( # {{{
# These are exceptions that DON'T pass the name patterns but DO look like the ASCII characters.
# They are added to the list of look-alikes.
['0020']='' # " "
['0021']='' # "!"
['0022']='âââ€œâ€â€ŸğŸ™¶ğŸ™·' # """
['0023']='' # "#"
['0024']='' # "$"
['0025']='' # "%"
['0026']='' # ampersand
['0027']='Ê»Ê½â€˜â€™â›âœï¸' # "'"
['0028']='' # "("
['0029']='' # ")"
['002A']='ê˜' # "*"
['002B']='âœ¢âœ£âœ¤â¨¤â¨¦' # "+"
['002C']='' # ","
['002D']='' # "-"
['002E']='' # "."
['002F']='' # "/"
['0030']='ğŸ¶ğŸ„' # "0"
['0031']='ğŸ·ğŸ„‚â’ˆ' # "1"
['0032']='ğŸ¸ğŸ„ƒâ’‰ğ‘¶¤' # "2"
['0033']='ğŸ¹ğŸ„„â’Šá­”ğ–­•ğ‹§ğ‘‡˜' # "3"
['0034']='ğŸºğŸ„…â’‹êœ®êœ¯à©«à««ğ‘‡•ğ‘‹µğ‘›…' # "4"
['0035']='ğŸ»ğŸ„†â’Œ' # "5"
['0036']='ğŸ¼ğŸ„‡â’á±”ê©”á±™ğ‘µ™' # "6"
['0037']='ğŸ½ğŸ„ˆâ’á®´' # "7"
['0038']='ğŸ¾ğŸ„‰â’à§ªğ£‹à­«á¥á‚™' # "8"
['0039']='ğŸ¿ğŸ„Šâ’à¥§à©§à«§ğ‘™‘à­¨ğ–©¥ğ‘„½ğ‘›‡ğ‘±—ğ‘µ˜' # "9"
['003A']='Ö‰' # ":"
['003B']='' # ";"
['003C']='' # "<"
['003D']='ê“¿â§¤' # "="
['003E']='' # ">"
['003F']='ğ‹¶' # "?"
['0040']='' # "@"
['0041']='ğ™°Ù¨Û¸á§˜ê£˜Ãƒáºªáº´â²' # "A"
['0042']='ğ™±ğ‘µ•' # "B"
['0043']='ğ™²ğ–­–ğ’¨' # "C"
['0044']='ğ™³' # "D"
['0045']='ğ™´à©¬à«¬ê£–ğ‹¦ğ‘‹¶ğ‘‘–ğ‘™–ğ…ˆà«¯à±¯áŸ©á¸šáº¼á»„' # "E"
['0046']='ğ™µ' # "F"
['0047']='ğ™¶' # "G"
['0048']='ğ™·' # "H"
['0049']='ğ™¸Ä¨á¸¬' # "I"
['004A']='ğ™¹ğ´¶ğ‘µ—' # "J"
['004B']='ğ™ºğ–­—ğ–­˜ğ–­™' # "K"
['004C']='ğ™»ğ‘ƒ¸â©â±¢' # "L"
['004D']='ğ™¼' # "M"
['004E']='ğ™½ĞĞ˜Ó¢Ó¤Ã‘' # "N"
['004F']='ğ™¾Ã•È¬á¹Œá¹á»–á» ' # "O"
['0050']='ğ™¿à­§ğ‘ƒ±' # "P"
['0051']='ğš€' # "Q"
['0052']='ğšê­±' # "R"
['0053']='ğš‚È˜' # "S"
['0054']='ğšƒÈšê›µğ®ê­²' # "T"
['0055']='ğš„á®¸ğ’©Ä²Å¨á¹´á¹¸á»®' # "U"
['0056']='ğš…Ù§Û·ß‡ğ‹·á¹¼â±' # "V"
['0057']='ğš†' # "W"
['0058']='ğš‡' # "X"
['0059']='ğšˆá»¸' # "Y"
['005A']='ğš‰á‚—' # "Z"
['005B']='' # "["
['005C']='' # "\"
['005D']='' # "]"
['005E']='' # "^"
['005F']='' # "_"
['0060']='Õâ€›ï¸‘' # "`"
['0061']='ğšŠÃ£áº«áºµ' # "a"
['0062']='ğš‹á¥‡ğ‘ƒµğ‹¨ğ‘ƒ¹áµ¬' # "b"
['0063']='ğšŒ' # "c"
['0064']='ğšğ¹ ğ‘¶¡ğ£Œáµ­' # "d"
['0065']='ğšğ‘„ºğ‘™™á¸›áº½á»…' # "e"
['0066']='ğšğ£áµ®' # "f"
['0067']='ğš' # "g"
['0068']='ğš‘Òº' # "h"
['0069']='ğš’Ä©á¸­' # "i"
['006A']='ğš“' # "j"
['006B']='ğš”' # "k"
['006C']='ğš•É«' # "l"
['006D']='ğš–áµ¯' # "m"
['006E']='ğš—Å‰Ã±áµ°' # "n"
['006F']='ğš˜ÃµÈ­á¹á¹á»—á»¡' # "o"
['0070']='ğš™áµ±' # "p"
['0071']='ğššğ´¹' # "q"
['0072']='ğš›áµ²áµ³' # "r"
['0073']='ğšœÈ™ğ‘›ˆáµ´â¸¯' # "s"
['0074']='ğšÈ›áµµ' # "t"
['0075']='ğšĞ¸ÑÓ£Ó¥Å©á¹µá¹¹á»¯' # "u"
['0076']='ğšŸá±‡á¥Ñ¶Ñ·á¹½' # "v"
['0077']='ğš ' # "w"
['0078']='ğš¡á™®' # "x"
['0079']='ğš¢ê§¶ğ’¦Ğ£Ó®Ó°Ó²ÑƒÓ¯Ó±Ó³á»¹' # "y"
['007A']='ğš£áµ¶' # "z"
['007B']='' # "{"
['007C']='âœâŸğ–­ê˜¡â¢â¥ï¸³ï¸´â­' # "|"
['007D']='' # "}"
['007E']='' # "~"
) # }}}

generateEquivalents() { # {{{
    declare -A equivalents_esc
    declare -A equivalents_lit
    {
        if [[ ! -f "$dataLocation" ]];then # if the data file doesn't exist yet
            echo -e "The Unicode data file has not been downloaded yet.\nDownloading to $dataLocation" 
            mkdir -p "${dataLocation%/*}" # ensure the directory exists
            curl "$dataUrl" > "$dataLocation" # download the file
        fi
    } 1>&2 # send all this block's output to stderr
    echo Generating visually equivalent character list: "$equivFile" 1>&2
    {
        for key in "${!namePatterns[@]}";do
            # search the Unicode data for named-alike chars, exclude problem chars and stuff where name-alike != look-alike
            IFS=$'\n' matches=( $( \
                                    grep -e "${namePatterns[$key]}" ~/.local/share/UnicodeData.txt \
                                    | grep -v -e '^009D' -e '^009F' -e 'COMBINING' -e 'ZERO WIDTH' \
                                        -e 'MEDEFAIDRIN' -e 'ADLAM' -e 'WARANG' -e 'OLD HUNGARIAN' \
                                        -e 'OSAGE' -e 'GLAGOLITIC' -e 'CHEROKEE' \
                                ) ) # indexes from 0
            keyLit=$(printf '\U'"$key")
            len=${#matches[@]}
            for (( i=0; i<len; ++i ));do
                esc="${matches[$i]%%;*}" # remove everything except the escape
                lit="$(printf '\U'"$esc")"
                # if it's not one of the exclusionary exeptions and it's not the ASCII character
                if [[ ( ! "${except_exclude["$key"]}" =~ "$lit" ) && ( ! "$keyLit" == "$lit" ) ]];then
                    #equivalents_esc["$key"]+="$esc," # add it to the list of escaped equivalents
                    equivalents_lit["$key"]+="$lit" # add it to the list of literal equivalents
                fi
            done
            equivalents_lit["$key"]+="${except_include["$key"]}" # tack the includes on the end
            #echo -e "\e[32m--- key: $key literal: \U00$key ---\e[0m"
            # Put the ASCII character on the first column. The look-alikes come after.
            echo "$keyLit${equivalents_lit["$key"]}"
        done
    } > "$equivFile"
} # }}}
equivalizeChar() { # {{{
    local C="$1"
    if [[ ! "$asciiChars" =~ "$C" ]]; then # we don't have a visual equivalent
        echo -n "$C" # pass the character through unchanged
    fi
    cEquivs="${equivs["$C"]}"
    cEquivsLen="${#cEquivs}"
    j=$(( RANDOM % (cEquivsLen-1) )) # why are all the non-whitespace equivs have an empty character at the end?
    cEquiv="${cEquivs: $j:1}"
    #for (( k=0; k<cEquivsLen; ++k ));do
    #    echo "k: $k cEquivs[k]: \"${cEquivs: $k:1}\""
    #done
    #echo "C: $C cEquiv: $cEquiv cEquivs: $cEquivs j: $j cEquivsLen: $cEquivsLen"
    echo -n "$cEquiv"
} # }}}

# main program flow {{{
while getopts 'gh' name; do # process option flags
    case $name in
        g) generateEquivalents;;
        h) echo "$helpText" && exit 1;;
    esac
done

if shift $(( $OPTIND - 1 )); then # shift to the first non-option arg; if there are arguments after the options
    while [[ $? == 0 ]]; do # while the previous exit status (shift) is good
        [[ "$1" ]] && input+="$1 "
        shift
    done
fi
if [[ -z "$input" ]];then
    usestdin=true
    input=${input: 0:-1} # snip off that trailing space
else
    usestdin=false # if there was no input, use stdin
fi

if [[ ! -f "$equivFile" ]];then
    echo "$equivFile does not exist. It will be [re]generated."
    generateEquivalents
fi

declare -A equivs
while IFS='' read -rd $'\n' line; do # read in the pre-processed look-alikes
    leading=${line: 0:1} # the first character
    trailing=${line: 1} # everything but the first (index 0) character
    equivs["$leading"]="$trailing" # use the leading char as the key
done < "$equivFile"
asciiChars="${!equivs[*]}"

# Translate ASCII characters into Unicode look-alikes
if [[ "$usestdin" == true ]]; then
    while IFS='' read -rN1 C; do # convert characters coming from stdin
        equivalizeChar "$C"
    done
else
    nchar=${#input}
    for (( i=0; i<nchar; ++i )); do # convert chars given as arguments
        equivalizeChar "${input: $i:1}" # select the ith character from the input
    done
    echo
fi
# }}}
exit 0
